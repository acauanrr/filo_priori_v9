# ğŸ”¬ Feature Selection Report (Expert-Based)

**Method**: Domain Knowledge + Baseline Performance Analysis
**Date**: 2025-11-14
**Context**: Experiment 05 (29 features) degraded performance vs Exp 04a (6 features)

---

## ğŸ¯ Strategy

**Problem**: Expanding from 6 â†’ 29 features caused overfitting and degraded APFD (0.6210 â†’ 0.5997)

**Solution**: Hybrid approach
1. **Keep all 6 baseline features** - Proven performance (APFD = 0.6210)
2. **Add 4 carefully selected new features** - Maximum complementary value

---

## ğŸ† Top-10 Selected Features

| # | Feature Name | Index | Source | Justification |
|---|--------------|-------|--------|---------------|
| 1 | **test_age** | 0 | V1 Baseline | Fundamental lifecycle feature |
| 2 | **failure_rate** | 1 | V1 Baseline | Core failure prediction signal |
| 3 | **recent_failure_rate** | 2 | V1 Baseline | Temporal failure pattern |
| 4 | **flakiness_rate** | 3 | V1 Baseline | Test stability indicator |
| 5 | **consecutive_failures** | 7 | NEW | Direct signal: currently failing |
| 6 | **max_consecutive_failures** | 9 | NEW | Historical failure severity |
| 7 | **failure_trend** | 13 | NEW | Trend analysis: failures increasing |
| 8 | **commit_count** | 20 | V1 Baseline | Code change volume |
| 9 | **test_novelty** | 21 | V1 Baseline | New test flag |
| 10 | **cr_count** | 23 | NEW | Code review impact on failures |

---

## ğŸ“Š Feature Categories

**Baseline Features (6)**: âœ… Proven in Exp 04a (APFD = 0.6210)
- test_age, failure_rate, recent_failure_rate, flakiness_rate, commit_count, test_novelty

**New Features (4)**: ğŸ†• Carefully selected for complementary value
- consecutive_failures, max_consecutive_failures, failure_trend, cr_count

**Feature Types**:
- Rate Features: 3 (failure_rate, recent_failure_rate, flakiness_rate)
- Count Features: 3 (consecutive_failures, max_consecutive_failures, commit_count, cr_count)
- Age Features: 1 (test_age)
- Trend Features: 1 (failure_trend)
- Flags: 1 (test_novelty)

---

## ğŸ” Rationale for New Features

### 1. consecutive_failures (index 7)
**Why**: Tests currently in a failure streak are highly likely to fail again.
- **Signal Strength**: VERY HIGH
- **Complementarity**: Adds "current state" to historical rates
- **Example**: Test failed last 3 builds â†’ 75% chance to fail next build

### 2. max_consecutive_failures (index 9)
**Why**: Identifies tests with chronic failure patterns.
- **Signal Strength**: HIGH
- **Complementarity**: Captures historical severity beyond avg failure_rate
- **Example**: Test that had 10-build failure streak is inherently problematic

### 3. failure_trend (index 13)
**Why**: Detects tests transitioning from stable â†’ failing.
- **Signal Strength**: MEDIUM-HIGH
- **Complementarity**: Adds derivative (change) to raw rates
- **Example**: failure_rate increased from 0.1 â†’ 0.4 recently â†’ trend = +0.3

### 4. cr_count (index 23)
**Why**: Code reviews directly correlate with code changes â†’ failure risk.
- **Signal Strength**: MEDIUM
- **Complementarity**: More specific than generic commit_count
- **Example**: 5 CRs merged recently â†’ high change volume â†’ higher failure risk

---

## ğŸ“‹ Next Steps: Experiment 06

**Configuration**:
```yaml
structural:
  input_dim: 10  # â† Reduced from 29 to 10
  extractor:
    use_v2_5: true  # â† New V2.5 with selected features only
    selected_features: [0, 1, 2, 3, 7, 9, 13, 20, 21, 23]

model:
  structural:
    input_dim: 10
    hidden_dim: 64  # â† Back to V1 capacity (was 128 for 29 features)
    num_layers: 2
    dropout: 0.1
```

**Expected Results**:
- âœ… APFD: 0.62-0.65 (match or exceed baseline)
- âœ… F1 Macro: 0.52-0.56 (improve over Exp 05's 0.49)
- âœ… Less overfitting (10 features vs 29)
- âœ… Retain proven signals (6 baseline) + add new value (4 selected)

---

## âœ… Success Criteria

| Metric | Target | Baseline (04a) | Exp 05 (29 feat) |
|--------|--------|----------------|------------------|
| **APFD** | â‰¥ 0.62 | 0.6210 | 0.5997 âŒ |
| **F1 Macro** | â‰¥ 0.52 | 0.5294 | 0.4935 âŒ |
| **APFD â‰¥ 0.7** | â‰¥ 40% | 40.8% | 36.5% âŒ |

**GO Criteria**:
- âœ… APFD â‰¥ 0.62 (match baseline)
- âœ… F1 Macro â‰¥ 0.52

**NO-GO Criteria**:
- âŒ APFD < 0.60
- âŒ F1 Macro < 0.50

---

## ğŸ“ Feature Indices for Implementation

**Selected indices**: `[0, 1, 2, 3, 7, 9, 13, 20, 21, 23]`

**Usage in StructuralFeatureExtractorV2.5**:
```python
SELECTED_FEATURE_INDICES = [0, 1, 2, 3, 7, 9, 13, 20, 21, 23]

def transform_v2_5(self, df: pd.DataFrame) -> np.ndarray:
    # Extract all 29 features first
    features_full = self.transform_v2(df)  # [N, 29]

    # Select only the 10 chosen features
    features_selected = features_full[:, SELECTED_FEATURE_INDICES]  # [N, 10]

    return features_selected
```

---

**Generated by**: Expert Feature Selection Tool
**Author**: Filo-Priori V8 Team
**Next Action**: Implement Experiment 06 with these 10 features
